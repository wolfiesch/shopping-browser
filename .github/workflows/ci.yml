name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Syntax check
        run: |
          python -m py_compile scripts/cli.py
          python -m py_compile scripts/run.py
          python -m py_compile scripts/base.py
          python -m py_compile scripts/cdp_parser.py
          python -m py_compile scripts/session_pool.py
          python -m py_compile scripts/db/models.py
          python -m py_compile scripts/db/tracker.py
          python -m py_compile scripts/adapters/__init__.py
          python -m py_compile scripts/adapters/amazon.py
          python -m py_compile scripts/adapters/newegg.py

      - name: Install ruff
        run: pip install ruff

      - name: Lint
        run: ruff check scripts/ --select E,W,F --ignore E402,F401,E501
